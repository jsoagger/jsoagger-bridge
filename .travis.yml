language: java

# -------------  ALL BRANCHES FIRE MVN INSTALL  ------------- ------------- --------
# MASTER: BUILD ON COMMIT (NO DEPLOY)
# +++++++++++++  STABLE AND TAGS FIRE DEPLOY    ++++++++++++++++++++++++++++++++++++
# TAGS: BUILD ON COMMIT + DEPLOY SONATYPE VERSION  RELEASE
# +++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
# No need to add secure key because we dont need github release for this project
# -------------------------- ------------- ------------- ------------- ------------- 

matrix:
  include:
    - os: linux
      dist: xenial
      jdk: openjdk11
            
cache:
    directories:
    - $HOME/.m2/repository


before_install:
    - export GPG_TTY=/dev/pts/4
    - echo $GPG_SECRET_KEYS | base64 --decode | $GPG_EXECUTABLE --import
    - echo $GPG_OWNERTRUST | base64 --decode | $GPG_EXECUTABLE --import-ownertrust

install: 
    mvn --settings .maven.xml install -DskipTests=true -Dgpg.skip -Dmaven.javadoc.skip=false -B -V
      
      
before_deploy:
    - mvn help:evaluate -N -Dexpression=project.version|grep -v '\['
    - export project_version=$(mvn help:evaluate -N -Dexpression=project.version|grep -v '\[')


deploy: 
# 1. Trigger a version deploy when a commit on tag
    - provider: script
      script: bash .travis/release.sh 
      skip_cleanup: true
      on:
        tags: true
        all_branches: true
 
script:
  - echo PATH = ${PATH}
  - echo $JAVA_HOME
  - java -version
 